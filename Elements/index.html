<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Alchemy Infinity - Expanded</title>
<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:linear-gradient(#0f2027,#000);
  color:white;
  overflow:hidden;
  user-select:none; /* prevent text selection */
}

/* Sidebar */
#sidebar{
  position:fixed;
  left:0;
  top:0;
  width:260px;
  height:100vh;
  background:#111;
  border-right:2px solid #333;
  overflow-y:auto;
  padding:10px;
}

#workspace{
  margin-left:260px;
  height:100vh;
  position:relative;
}

.element{
  background:#222;
  margin:4px 0;
  padding:6px;
  border-radius:6px;
  cursor:grab;
  user-select:none;
}

.item{
  position:absolute;
  padding:10px 14px;
  border-radius:12px;
  font-weight:bold;
  cursor:grab;
  background:#f0f0f0;
  color:black;
  transition:transform .15s, opacity .2s;
  user-select:none;
}

.item.magnet{
  transform:scale(1.15);
  box-shadow:0 0 15px gold;
}

button{
  margin-top:6px;
  padding:6px 8px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

.panel{
  position:fixed;
  right:10px;
  top:10px;
  background:#111;
  padding:10px;
  border-radius:8px;
  max-width:260px;
  max-height:300px;
  overflow:auto;
  display:none;
}

#message{
  position:absolute;
  bottom:20px;
  left:280px;
  color:gold;
  font-size:18px;
  pointer-events:none;
}
</style>
</head>
<body>

<div id="sidebar">
  <h3>Alchemy Infinity</h3>
  <div id="elementList"></div>
  <button onclick="toggleBook()">üìñ Recipe Book</button>
  <button onclick="toggleAchievements()">üèÜ Achievements</button>
  <button onclick="clearWorkspace()">üóë Clear</button>
</div>

<div id="workspace"></div>
<div id="message"></div>
<div id="book" class="panel"></div>
<div id="achievements" class="panel"></div>

<script>
/* -------------------- DATA -------------------- */
const icons={
Fire:"üî•",Water:"üíß",Earth:"üåç",Air:"üå¨Ô∏è",
Steam:"‚òÅÔ∏è",Mud:"üü§",Lava:"üåã",Rain:"üåßÔ∏è",
Plant:"üå±",Life:"üß¨",Human:"üßç",
Metal:"‚öôÔ∏è",Electricity:"‚ö°",
Machine:"ü§ñ",Robot:"ü¶æ",AI:"üß†",
Ice:"‚ùÑÔ∏è",Smoke:"üí®",Mist:"üå´Ô∏è",Storm:"‚õàÔ∏è",
Sand:"üèñÔ∏è",Glass:"ü™ü",Tree:"üå≥",Clay:"üè∫",Boil:"üíßüî•",
House:"üè†",Factory:"üè≠",Skyscraper:"üè¢",Road:"üõ£Ô∏è",
Car:"üöó",Train:"üöÜ",Airplane:"‚úàÔ∏è",Helicopter:"üöÅ",Ship:"üõ≥Ô∏è",
SuperAI:"ü§ñüí°",RocketFuel:"‚õΩ",Brick:"üß±",Snow:"üå®Ô∏è",Lightning:"üå©Ô∏è"
};

let discovered = JSON.parse(localStorage.getItem("alchemy_save")) || ["Fire","Water","Earth","Air"];
let discoveredRecipes = JSON.parse(localStorage.getItem("alchemy_recipes")) || [];

const recipes={};
function addRecipe(a,b,r){
  recipes[a+"+"+b]=r;
  recipes[b+"+"+a]=r;
}

/* -------------------- CORE RECIPES -------------------- */
addRecipe("Fire","Water","Steam");
addRecipe("Water","Earth","Mud");
addRecipe("Earth","Fire","Lava");
addRecipe("Air","Water","Rain");
addRecipe("Rain","Earth","Plant");
addRecipe("Plant","Water","Life");
addRecipe("Life","Earth","Human");
addRecipe("Metal","Electricity","Machine");
addRecipe("Machine","Human","Robot");
addRecipe("Robot","Robot","AI");

/* -------------------- EXPANDED RECIPES -------------------- */
addRecipe("Fire","Air","Smoke");
addRecipe("Water","Air","Mist");
addRecipe("Water","Fire","Boil");
addRecipe("Air","Fire","Lightning");
addRecipe("Water","Lightning","Ice")
addRecipe("Ice","Fire","Water");
addRecipe("Ice","Air","Snow");
addRecipe("Rain","Air","Storm");
addRecipe("Sand","Fire","Glass");
addRecipe("Plant","Mud","Tree");
addRecipe("Tree","Life","Human");
addRecipe("Robot","AI","SuperAI");
addRecipe("Metal","Fire","Steel");
addRecipe("Water","Earth","Clay");
addRecipe("Fire","Snow","RocketFuel")

/* BUILDINGS */
addRecipe("Clay","Fire","Brick");
addRecipe("Brick","Brick","House");
addRecipe("House","House","Skyscraper");
addRecipe("Metal","Metal","Factory");
addRecipe("Road","Metal","Train");
addRecipe("Car","Machine","Airplane");
addRecipe("Airplane","Machine","Helicopter");
addRecipe("Water","Metal","Ship");


/* -------------------- AUDIO -------------------- */
const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
function playMergeSound(){
  const osc=audioCtx.createOscillator();
  const gain=audioCtx.createGain();
  osc.frequency.value=600;
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  gain.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+0.4);
  osc.stop(audioCtx.currentTime+0.4);
}

/* -------------------- UI -------------------- */
const list=document.getElementById("elementList");
const workspace=document.getElementById("workspace");
const message=document.getElementById("message");

function renderMenu(){
  list.innerHTML="";
  discovered.sort().forEach(name=>{
    const div=document.createElement("div");
    div.className="element";
    div.textContent=(icons[name]||"")+" "+name;
    div.onmousedown=e=>spawnFromMenu(e,name);
    div.ondragstart = e => e.preventDefault(); 
    list.appendChild(div);
  });
}

function showMessage(text){
  message.textContent=text;
  setTimeout(()=>message.textContent="",2000);
}

function toggleBook(){
  const panel=document.getElementById("book");
  panel.style.display=panel.style.display==="block"?"none":"block";
  panel.innerHTML="<h3>Recipes</h3>"+discoveredRecipes.join("<br>");
}

function toggleAchievements(){
  const panel=document.getElementById("achievements");
  panel.style.display=panel.style.display==="block"?"none":"block";
  panel.innerHTML="";
  if(discovered.length>=5) panel.innerHTML+="üèÜ Beginner Alchemist<br>";
  if(discovered.length>=10) panel.innerHTML+="üèÜ Intermediate Alchemist<br>";
  if(discovered.length>=20) panel.innerHTML+="üèÜ Master Alchemist<br>";
}

function clearWorkspace(){
  workspace.innerHTML="";
}

function save(){
  localStorage.setItem("alchemy_save",JSON.stringify(discovered));
  localStorage.setItem("alchemy_recipes",JSON.stringify(discoveredRecipes));
}

/* -------------------- SPAWN & DRAG -------------------- */
const SIDEBAR_WIDTH = 260;
let dragging=null;
let magnetTarget=null;
let offsetX=0,offsetY=0;
let combineLock=false;

function spawn(name,x=300,y=200){
  const el=document.createElement("div");
  el.className="item";
  el.textContent=(icons[name]||"")+" "+name;
  el.dataset.name=name;
  workspace.appendChild(el);
  el.style.left=x+"px";
  el.style.top=y+"px";
  enableDrag(el);
}

function spawnFromMenu(e,name){
  e.preventDefault(); 
  const el=document.createElement("div");
  el.className="item";
  el.textContent=(icons[name]||"")+" "+name;
  el.dataset.name=name;
  workspace.appendChild(el);
  el.style.left=(e.clientX-SIDEBAR_WIDTH)+"px";
  el.style.top=e.clientY+"px";
  enableDrag(el,true);
}

function enableDrag(el,autoDrag=false){
  el.onmousedown = e=>{
    e.preventDefault(); 
    dragging=el;
    offsetX=e.offsetX;
    offsetY=e.offsetY;
    document.onmousemove=move;
    document.onmouseup=stop;
  };
  el.ondragstart = e=>e.preventDefault(); 

  function move(e){
    if(!dragging) return;
    dragging.style.left=(e.clientX-offsetX-SIDEBAR_WIDTH)+"px";
    dragging.style.top=(e.clientY-offsetY)+"px";
    detectMagnet(dragging);
  }

  function stop(){
    if(magnetTarget) combine(dragging,magnetTarget);
    clearMagnet();
    dragging=null;
    document.onmousemove=null;
    document.onmouseup=null;
  }

  if(autoDrag) el.onmousedown(event);
}

/* -------------------- MAGNET & COMBINE -------------------- */
function detectMagnet(el){
  magnetTarget=null;
  document.querySelectorAll(".item").forEach(other=>{
    if(other===el) return;
    const r1=el.getBoundingClientRect();
    const r2=other.getBoundingClientRect();
    const dx=r1.left-r2.left;
    const dy=r1.top-r2.top;
    const dist=Math.sqrt(dx*dx+dy*dy);
    if(dist<70 && recipes[el.dataset.name+"+"+other.dataset.name]){
      other.classList.add("magnet");
      magnetTarget=other;
    }
  });
}

function clearMagnet(){
  document.querySelectorAll(".item").forEach(i=>i.classList.remove("magnet"));
}

function combine(a,b){
  if(combineLock) return;
  const result=recipes[a.dataset.name+"+"+b.dataset.name];
  if(!result) return;

  combineLock=true;
  a.style.opacity=0; b.style.opacity=0;
  a.style.transform="scale(1.3)";
  b.style.transform="scale(1.3)";

  setTimeout(()=>{
    const rect=a.getBoundingClientRect();
    createParticles(rect.left,rect.top);
    playMergeSound();
    a.remove(); b.remove();
    spawn(result, rect.left-SIDEBAR_WIDTH, rect.top);

    if(!discovered.includes(result)){
      discovered.push(result);
      discoveredRecipes.push(a.dataset.name+" + "+b.dataset.name+" = "+result);
      renderMenu();
      toggleAchievements();
      showMessage("‚ú® "+result+" discovered!");
      save();
    }
    combineLock=false;
  },200);
}

/* -------------------- PARTICLES -------------------- */
function createParticles(x,y){
  for(let i=0;i<12;i++){
    const p=document.createElement("div");
    p.style.position="absolute";
    p.style.width="6px";
    p.style.height="6px";
    p.style.background="gold";
    p.style.left=(x-SIDEBAR_WIDTH)+"px";
    p.style.top=y+"px";
    workspace.appendChild(p);
    p.animate([
      {transform:"translate(0,0)",opacity:1},
      {transform:`translate(${Math.random()*80-40}px,${Math.random()*80-40}px)`,opacity:0}
    ],{duration:600});
    setTimeout(()=>p.remove(),600);
  }
}

/* -------------------- INIT -------------------- */
renderMenu();
toggleAchievements();
</script>
</body>
</html>
